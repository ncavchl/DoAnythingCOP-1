---
작성일 : 2020-09-13
docker version : 19.03.12
---

[TOC]

---

## Docker 설치하기

```bash
curl -s https://get.docker.com | sudo sh  # 리눅스 배포판에 따라 자동으로 최신 도커 설치
sudo usermod -aG docker ubuntu			  # ubuntu 경우 유저권한 추가
```

### 설치 확인

```bash
$ docker version
```

![image-20200913220433604](img/ch02_%EC%84%A4%EC%B9%98%EB%B6%80%ED%84%B0%20%EC%8B%A4%ED%96%89%EA%B9%8C%EC%A7%80%20%ED%95%84%EA%B8%B0/image-20200913220433604.png)

> ![image-20200915164121717](img/ch02_%EC%84%A4%EC%B9%98%EB%B6%80%ED%84%B0%20%EC%8B%A4%ED%96%89%EA%B9%8C%EC%A7%80%20%ED%95%84%EA%B8%B0/image-20200915164121717.png)
>
> localhost에 docker server가 띄어져 있고 명령어는 client를 통해 실행



## Docker 기본 명령어 

### ▶ `run`

#### - 컨테이너 실행 및 옵션

```bash
$ docker run [OPTIONS] IMAGE[:TAG|@DIGEST] [COMMAND] [ARG...]
```

|  OPTIONS  |                        설명                        |
| :-------: | :------------------------------------------------: |
|    -d     |          detached mode (백그라운드 모드)           |
|    -p     |          호스트와 컨테이너의 포트를 연결           |
|    -v     |         호스트와 컨테이너의 디렉토리 연결          |
|    -e     |        컨테이너 내에서 사용할 환경변수 설정        |
|  --name   |                 컨테이너 이름 설정                 |
|   --rm    |         프로세스 종료시 컨테이너 자동제거          |
|    -it    | -i -t 동시에 사용한 것으로 터미널 입력을 위한 옵션 |
| --network |                   네트워크 연결                    |



#### - 실습

**Ubuntu  그냥 실행**

```bash
$ docker run ubuntu:20.04
```

![image-20200915165100199](img/ch02_%EC%84%A4%EC%B9%98%EB%B6%80%ED%84%B0%20%EC%8B%A4%ED%96%89%EA%B9%8C%EC%A7%80%20%ED%95%84%EA%B8%B0/image-20200915165100199.png)

- 기존에 이미지가 존재하면 실행
- 없으면 다운로드 후(pull) 컨테이너 생성(create)하고 실행(start)
- 뭘 하라는 명령어 전달이 없어 생성되자 마자 종료.



**Ubuntu 쉘 실행**

```bash
$ docker run --rm -it ubuntu:20.04 /bin/sh
```

![image-20200915165336467](img/ch02_%EC%84%A4%EC%B9%98%EB%B6%80%ED%84%B0%20%EC%8B%A4%ED%96%89%EA%B9%8C%EC%A7%80%20%ED%95%84%EA%B8%B0/image-20200915165336467.png)

- `--rm` : 컨테이너가 종료되면 삭제됨
- `-it` : 컨테이너 내부에서 키보드 입력 가능



**CentOS 실행**

```bash
$ docker run --rm -it centos:8 /bin/sh
```

![image-20200915165639009](img/ch02_%EC%84%A4%EC%B9%98%EB%B6%80%ED%84%B0%20%EC%8B%A4%ED%96%89%EA%B9%8C%EC%A7%80%20%ED%95%84%EA%B8%B0/image-20200915165639009.png)

- 다양한 리눅스 배포판 실행 가능
- 공통점은 모두 동일한 커널 사용
- 다른 기능 필요없으면 alpine 사용하면 됨



**hashicorp 실행**

```bash
$ docker run --rm -p 5678:5678 hashicorp/http-echo -text="hello world"
```

![image-20200915172202901](img/ch02_%EC%84%A4%EC%B9%98%EB%B6%80%ED%84%B0%20%EC%8B%A4%ED%96%89%EA%B9%8C%EC%A7%80%20%ED%95%84%EA%B8%B0/image-20200915172202901.png)

- `-p`  : 컨테이너 포트를 호스트 포트로 연결



**redis 실행**

```bash
$ docker run --rm -p 1234:6379 redis
```

![image-20200915173202324](img/ch02_%EC%84%A4%EC%B9%98%EB%B6%80%ED%84%B0%20%EC%8B%A4%ED%96%89%EA%B9%8C%EC%A7%80%20%ED%95%84%EA%B8%B0/image-20200915173202324.png)



**mysql 실행**

```bash
$ docker run -d -p 3306:3306 \
	-e MYSQL_ALLOW_EMPTY_PASSWORD=true \
	--name mysql \
	mysql:5.7
```

- `-d` : 백그라운드로 실행

- 백그라운드 컨테이너 접속은 `exec`를 사용함

  ```bash
  $ docker exec -it mysql mysql
  ```

  ![image-20200915174213667](img/ch02_%EC%84%A4%EC%B9%98%EB%B6%80%ED%84%B0%20%EC%8B%A4%ED%96%89%EA%B9%8C%EC%A7%80%20%ED%95%84%EA%B8%B0/image-20200915174213667.png)

  ```mysql
  # 좀 이따 쓸 워드 프레스에 DB 생성 쿼리 수행
  CREATE database wp CHARACTER SET utf8;
  GRANT all privileges on wp.* to wp@'%' identified by 'wp';
  flush privileges;
  quit
  ```



**워드프레스 블로그 실행하기**

```bash
$ docker run -d -p 8080:80 \
	-e WORDPRESS_DB_HOST=host.docker.internal \
	-e WORDPRESS_DB_NAME=wp \
	-e WORDPRESS_DB_USER=wp \
	-e WORDPRESS_DB_PASSWORD=wp \
	wordpress
```



#### - exec 명령어

이미 실행중인 도커 컨테이너에 접속할 때 사용하며 ssh 등 설치하지 않고(보안 취약) exec로 접속



### ▶ `ps, stop, rm, logs, images...`

**ps**

![image-20200915191401002](img/ch02_%EC%84%A4%EC%B9%98%EB%B6%80%ED%84%B0%20%EC%8B%A4%ED%96%89%EA%B9%8C%EC%A7%80%20%ED%95%84%EA%B8%B0/image-20200915191401002.png)

```bash
$ docker ps 	# 실행중인 컨테이너 목록
$ docker ps -a  # 모든 컨테이너 목록
```



**stop** 

![image-20200915191620259](img/ch02_%EC%84%A4%EC%B9%98%EB%B6%80%ED%84%B0%20%EC%8B%A4%ED%96%89%EA%B9%8C%EC%A7%80%20%ED%95%84%EA%B8%B0/image-20200915191620259.png)

```bash
$ docker stop [CONTAINER ID/NAMES]	# 컨테이너 중단
```



**rm**

![image-20200915191728100](img/ch02_%EC%84%A4%EC%B9%98%EB%B6%80%ED%84%B0%20%EC%8B%A4%ED%96%89%EA%B9%8C%EC%A7%80%20%ED%95%84%EA%B8%B0/image-20200915191728100.png)

```bash
$ docker rm [CONTAINER ID/NAMES]	# 컨테이너 삭제
```



**logs**

![image-20200915191848961](img/ch02_%EC%84%A4%EC%B9%98%EB%B6%80%ED%84%B0%20%EC%8B%A4%ED%96%89%EA%B9%8C%EC%A7%80%20%ED%95%84%EA%B8%B0/image-20200915191848961.png)

```bash
$ docker logs [CONTAINER ID/NAMES]		# 컨테이너 로그 확인
$ docker logs [CONTAINER ID/NAMES] -f 	# 실시간 로그 확인
```



**images**

![image-20200915192029723](img/ch02_%EC%84%A4%EC%B9%98%EB%B6%80%ED%84%B0%20%EC%8B%A4%ED%96%89%EA%B9%8C%EC%A7%80%20%ED%95%84%EA%B8%B0/image-20200915192029723.png)

```bash
$ docker images	# 이미지 목록 확인
```



**pull**

![image-20200915192250545](img/ch02_%EC%84%A4%EC%B9%98%EB%B6%80%ED%84%B0%20%EC%8B%A4%ED%96%89%EA%B9%8C%EC%A7%80%20%ED%95%84%EA%B8%B0/image-20200915192250545.png)

```bash
$ docker pull [IMAGE]	# 이미지 가져오기만 하기
```



**rmi**

![image-20200915192446729](img/ch02_%EC%84%A4%EC%B9%98%EB%B6%80%ED%84%B0%20%EC%8B%A4%ED%96%89%EA%B9%8C%EC%A7%80%20%ED%95%84%EA%B8%B0/image-20200915192446729.png)

``` bash
$ docker rmi [IMAGE]	# 이미지 삭제
```



**network create 명령어**

```bash
$ docker network create [OPTIONS] NETWORK	# 컨테이너간 통신할 가상 네트워크
```

```bash
$ docker network create app-network		# app-network 생성
$ docker network connect app-network mysql # mysql을 app-network에 연결
$ docker run -d -p 8080:80 \
	--network=app-network \
	-e WORDPRESS_DB_HOST=mysql \
	-e WORDPRESS_DB_NAME=wp \
	-e WORDPRESS_DB_USER=wp \
	-e WORDPRESS_DB_PASSWORD=wp \
	wordpress
```



### ▶ `volume`

```bash
$ docker rm -f mysql	# mysql 컨테이너 삭제
$ docker run [대충 mysql 실행하는 명령어]
```

도커 삭제 후 다시 실행하면 이전 데이터는 모두 날라간다!!

이를 방지하기 위해 container의 특정 데이터를 호스트 PC에 등록

```bash
$ docker run -d -p 3306:3306 \
	-e MYSQL_ALLOW_EMPTY_PASSWORD=true \
	--network=app-network \
	--name mysql \
	-v /my/own/datadir:/var/lib/mysql \
	mysql:5.7			
```



## Docker Compose 기본





## [개인실습] nginx 컨테이너 만들기





## [개인실습] php cli 컨테이너 실행하기



## :warning: 문제 발생시 

- docker stop 불가한 경우 [링크 참조](https://stackoverflow.com/questions/54279514/how-to-stop-running-container-if-error-response-from-daemon-is-cannot-kill-con)

  ```bash
  $ systemctl daemon-reload
  $ systemctl restart docker
  ```

  

