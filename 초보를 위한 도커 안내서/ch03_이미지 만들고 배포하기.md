---
작성일 : 2020-09-16
docker version : 19.03.12
---

[TOC]

## 도커 이미지 만들기 - 기본

> 지금까지는 누군가 만든 이미지를 사용했지만 이제 만들어보자.

### 이미지란

- 도커는 레이어드 파일시스템 기반 (AUFS, BTRFS, Overlayfs)
- 이미지는 프로세스가 실행되는 파일들의 집합(환경)
- 프로세스는 환경(파일)을 변경할 수 있음



### 상태 변화 

base image는 변화불가

![image-20200916204244075](img/ch03_%EC%9D%B4%EB%AF%B8%EC%A7%80%20%EB%A7%8C%EB%93%A4%EA%B3%A0%20%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0/image-20200916204244075.png)

```bash
$ docker run -it --name git ubuntu:latest bash
root@2f8bfff679f9:/# git
bash: git: command not found
root@2f8bfff679f9:/# apt-get update
root@2f8bfff679f9:/# apt-get install -y git
root@2f8bfff679f9:/# git --version
git version 2.17.1
```

```bash
$ docker commit git ubuntu:git    # git 이라는 container를 ubuntu의 git태그 달아 commit
```

![image-20200916205132409](img/ch03_%EC%9D%B4%EB%AF%B8%EC%A7%80%20%EB%A7%8C%EB%93%A4%EA%B3%A0%20%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0/image-20200916205132409.png)

> 새로운 이미지가 생성되고 해당 이미지에서는 git이 기본적으로 설치되어있음을 확인



### 도커 이미지 naming

`사용자명/이미지명:태그 .`   ex: subicura/ubuntu:git01

사용자명이 없는 경우, 공식 이미지



### 도커 이미지 만들기

> - 한번에 성공하는 빌드는 없음
> - 파란불이 성공
> - 리팩토링을 통해 최적화된 이미지 생성 필요

![image-20200916205412381](img/ch03_%EC%9D%B4%EB%AF%B8%EC%A7%80%20%EB%A7%8C%EB%93%A4%EA%B3%A0%20%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0/image-20200916205412381.png)



#### Dockerfile

|   명령어   |                         설명                         |
| :--------: | :--------------------------------------------------: |
|    FROM    |                     기본 이미지                      |
|    RUN     |                    쉘 명령어 실행                    |
|    CMD     | 컨테이너 기본 실행 명령어 (Entrypoint의 인자로 사용) |
|   EXPOSE   |                  오픈되는 포트 정보                  |
|    ENV     |                    환경변수 설정                     |
|    ADD     |      파일 또는 디렉토리 추가. URL/ZIP 사용가능       |
|    COPY    |               파일 또는 디렉토리 추가                |
| ENTRYPOINT |              컨테이너 기본 실행 명령어               |
|   VOLUME   |               외부 마운트 포인트 생성                |
|    USER    |        RUN, CMD, ENTRYPOINT를 실행하는 사용자        |
|  WORKDIR   |                  작업 디렉토리 설정                  |
|    ARGS    |                빌드타임 환경변수 설정                |
|   LABEL    |                   key-value 데이터                   |
|  ONBUILD   |    다른 빌드의 베이스로 사용될때 사용하는 명령어     |



#### 이미지 빌드하기

```bash
$ docker build -t {이미지명:태그} {빌드 컨텍스트}
$ docker build -t sample:1 .   # .은 현재 디렉터리 의미
```

```dockerfile
FROM ubuntu:latest
RUN apt-get update
RUN apt-get install -y git
```



#### dockerignore

- .gitignore와 비슷한 역할
- 빌드 컨텍스트에서 지정된 패턴의 파일을 무시
- .git이나 민감 정보 제외용



## 도커 이미지 만들기 - 웹 애플리케이션(nodejs)



## docker hub 이미지 관리



## docker 배포 기본



## [개인실습] Nginx 를 이용한 정적 페이지 서버 만들기



## [개인실습] Hellonnode 실습



